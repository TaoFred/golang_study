# 备用资源模块化显示

## 0. 背景说明

> 当前完整性检测软件对组态备用资源是以平铺的表格化显示的，而备用资源的导出文件是以卡件分组的结构显示备用通道信息（DCS：控制站-连接模块-机架-卡件-通道；SIS：机架-卡件-通道）
>
> 软件界面以表格平铺展示备用资源信息的形式不能完全满足用户的需求，希望展示的形式能够体现出像组态软件中一样的硬件层次结构

## 1 组态软件中对通道层级的显示

### 1.1 ECS-700：在控制站的硬件配置中，展示控制器下的硬件结构，定位通道的物理地址

> 非通信模块：

在控制站下，对于非通信连接模块，依次展开展示`[连接模块地址]连接模块型号`-`[机架地址]机架型号`-`[模块地址]模块型号`-`[通道地址]位号名`

![700非通信模块](/700非通信模块.png)

> 说明：非通信模块下的卡件通道数量（I/O位号数量）是确定的，已知的（8、16或者32）



> 通信模块：

在控制站下，对于通信模块，依次展开显示`[通信模块地址]通信模块型号`-`[机架地址]机架型号`-`[通信设备地址]通信设备型号`-`[槽位地址]`

![700通信模块](/700通信模块.png)

> 说明：在控制站的硬件结构中不显示通信模块下的通信I/O位号及其偏移地址信息，需要通过前四个硬件地址去匹配位号表中的通信位号地址，得到通信模块下的通信位号信息；



在硬件配置中的通信模块的四个地址对应于位号表中通信位号的前四个地址（通信节点序号-通信机架序号-从站地址-数据块编号），依据此信息得到通信模块下的通信位号数据，只有通过与位号表中的地址匹配后才能确定通信模块下的位号数量信息

![通信位号地址](/通信位号地址.png)



### 1.2 TCS-900：SafeContrix硬件I/O设备组态中用`机架SN号-模块槽位号-信号点号`标识I/O变量的地址

![900 IO变量](D:\Integrity\业务理解\备用资源模块化显示\900 IO变量.png)

>  SafeContrix中的I/O变量与TCS-900系统中的I/O信号点相对应。在SafeContrix中完成硬件组态后，系统自动生成I/O变量。

![900IO变量](D:\Integrity\业务理解\备用资源模块化显示\900IO变量.png)

> TCS-900机架中的输入/输出模块的信号点数是确定的（16点或32点）



### 1.3 Tricon：硬件组态下，显示Chassis-Slot-Points Number结构

> Tricon原本没有备用的说法，是延用TCS-900的备用规则

![tricon IO模块](D:\Integrity\业务理解\备用资源模块化显示\tricon IO模块.png)

> Tricon在硬件组态树中，显示机架-卡件-点位数量（点位数量存在8、16、32、64的情况），但是不会显示卡件下的I/O位号信息，需要依据位号表中的物理地址去识别所属的I/O模块，如下图所示。

![Tricon IO位号](D:\Integrity\业务理解\备用资源模块化显示\Tricon IO位号.png)

## 2 当前备用资源模块对通道的平铺显示

当前完整性平台中对I/O通道是以平铺的表格化显示：

> ECS-700的通道

1. 常规I/O位号地址信息：

   通过`[控制域地址.控制站地址]`  `节点序号`-`机架序号`-`模块序号`-`通道序号`去标识一个常规I/O位号（AI、AO、DI、DO）的地址信息

![700常规IO位号](D:\Integrity\业务理解\备用资源模块化显示\700常规IO位号.png)

2. 通信I/O位号地址信息：

   通过`[控制域地址.控制站地址] `  `通信节点序号`-`通信机架序号`-`从站地址`-`数据块编号`-`位号在数据块内的偏移地址`去标识一个通信I/O位号（AI、AO、DI、DO）的地址信息

![700通信IO位号](D:\Integrity\业务理解\备用资源模块化显示\700通信IO位号.png)

> TCS-900的通道(信号点)
>
> 疑问：目前只对900的I/O变量进行了备用区分，通信变量是否存在备用的说法
>
> 通过 `机架-模块-信号点` 标识一个I/O位号的地址信息

![900IO位号](D:\Integrity\业务理解\备用资源模块化显示\900IO位号.png)



> Tricon的通道：
>
> 通过组态软件中的物理地址，对应tricon中的`chassis-solt-point`，对于未分配位号的通道认为是备用的

![tricon通道](D:\Integrity\业务理解\备用资源模块化显示\tricon通道.png)

## 3 结构化、层次化显示通道信息的初步方案

> 对于SIS系统，备用通道只有常规的I/O位号，机架-卡件-通道三个地址即可标识位置，结构相对固定
>
> 对于DCS系统的通信模块，五个地址标识位置，且下属的位号数量不固定

### 3.1 模块化显示的概念逻辑结构

![tricon通道](D:\Integrity\业务理解\备用资源模块化显示\备用资源模块化显示的概念设计.png)

> 逻辑结构类似于硬件架构模块的展开形式
>
> **前端可以增加一个备用资源显示样式的模式选择（平铺表格显示/结构化显示）**

![备用资源表格模块化显示](/备用资源表格模块化显示.png)

> 一个子表格代表一个卡件下的通道数据

### 3.2 后端接口和数据结构设计

当前备用资源数据依赖于 `cfg_io` 和 `cfg_channnel` 两个表，并根据位号名称关联资产树表`asset_tree`，实现链接跳转。

1、体现通道的硬件层次结构

> 通道所属的硬件层次结构（DCS：`控制域-控制站-连接模块-机架-卡件`   SIS：`机架-卡件`）仿照硬件架构设计，通过资产树的 `asset_id` 和 `page_type` 获取结构数据

2、通道列表按卡件分组展示

> 属于同一个卡件下的通道分表显示，原有接口返回的数据结构按卡件区分